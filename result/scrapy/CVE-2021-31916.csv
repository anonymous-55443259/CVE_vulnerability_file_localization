"url","domain","state","text"
"https://bugzilla.redhat.com/show_bug.cgi?id=1946965","bugzilla.redhat.com","0","Title:
CVE-2021-31916 kernel: out of bounds array access in drivers/md/dm-ioctl.c

Attributes:
Keywords:
Security
Status:
CLOSED
          ERRATA
Alias:
CVE-2021-31916
Product:
Security Response
Classification:
Other
Component:
vulnerability
Sub Component:
---
Version:
unspecified
Hardware:
All
OS:
        Linux
Priority:
low
Severity:
       low
Target Milestone:
---
Assignee:
Red Hat Product Security
QA Contact:
Docs Contact:
URL:
Whiteboard:
Depends On:
1956197 1956198 1956199 1956200 1946966 1949682 1955627 1955628 1955629 1955630 1955631
Blocks:
1946967 1955255
TreeView+
        depends on /
        blocked
Reported:
2021-04-07 11:37 UTC by Marian Rehak
Modified:
2021-11-09 20:23 UTC
      (History)
CC List:
47 
          users
            (show)
acaringi
adscvr
agk
airlied
alciregi
bhu
blc
bmasney
brdeoliv
bskeggs
chwhite
crwood
dhoward
dvlasenk
eshatokhin
fhrbata
fpacheco
hdegoede
heinzm
hkrzesin
jarodwilson
jeremy
jforbes
jlelli
jonathan
josef
jshortt
jstancek
jwboyer
kcarcia
kernel-maint
kernel-mgr
lgoncalv
linville
masami256
mchehab
mlangsdo
msnitzer
nmurray
pmatouse
ptalbert
qzhao
rkeshri
rvrbovsk
steved
walters
williams
Fixed In Version:
Kernel 5.12
Doc Type:
If docs needed, set a value
Doc Text:
An out-of-bounds (OOB) memory write flaw was found in list_devices in drivers/md/dm-ioctl.c in the Multi-device driver module in the Linux kernel. A bound check failure allows an attacker with special user (CAP_SYS_ADMIN) privilege to gain access to out-of-bounds memory leading to a system crash, a leak of internal kernel information, or a privilege escalation problem.
Clone Of:
Environment:
Last Closed:
2021-11-09 20:23:19 UTC
Embargoed:


Comments:
Description
Marian Rehak
          2021-04-07 11:37:30 UTC
An out-of-bounds (OOB) memory write flaw was found in list_devices in drivers/md/dm-ioctl.c in the Multi-device driver module in the Linux kernel. A bound check failure allows an attacker with special user (CAP_SYS_ADMIN) privilege to gain access to out-of-bounds memory leading to a system crash, a leak of internal kernel information, or a privilege escalation problem.
References:
https://github.com/torvalds/linux/commit/4edbe1d7bcffcd6269f3b5eb63f710393ff2ec7a
https://seclists.org/oss-sec/2021/q1/268
Comment 1
Marian Rehak
          2021-04-07 11:38:13 UTC
Created kernel tracking bugs for this issue:
Affects: fedora-all [bug 1946966]
Comment 2
Justin M. Forbes
          2021-04-08 13:56:19 UTC
Any upstream link to more info or a patch for this?
Comment 3
Rohit Keshri
          2021-04-29 04:26:44 UTC
External References:
https://github.com/torvalds/linux/commit/4edbe1d7bcffcd6269f3b5eb63f710393ff2ec7a
https://seclists.org/oss-sec/2021/q1/268
Comment 5
Justin M. Forbes
          2021-04-29 22:27:51 UTC
This was fixed for Fedora with the 5.11.11 stable kernel updates.
Comment 8
Rohit Keshri
          2021-04-30 14:40:15 UTC
Mitigation:
Mitigation for this issue is either not available or the currently available options don't meet the Red Hat Product Security criteria comprising ease of use and deployment, applicability to widespread installation base or stability.
Comment 32
errata-xmlrpc
          2021-11-09 17:22:09 UTC
This issue has been addressed in the following products:
  Red Hat Enterprise Linux 8
Via RHSA-2021:4140 https://access.redhat.com/errata/RHSA-2021:4140
Comment 33
errata-xmlrpc
          2021-11-09 18:24:46 UTC
This issue has been addressed in the following products:
  Red Hat Enterprise Linux 8
Via RHSA-2021:4356 https://access.redhat.com/errata/RHSA-2021:4356
Comment 34
Product Security DevOps Team
          2021-11-09 20:23:15 UTC
This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):
https://access.redhat.com/security/cve/cve-2021-31916
"
"https://github.com/torvalds/linux/commit/4edbe1d7bcffcd6269f3b5eb63f710393ff2ec7a","github.com","0",""
"https://seclists.org/oss-sec/2021/q1/268","seclists.org","0","Title:
Linux Kernel: out of bounds array access in dm-ioctl.c

Content:
Hi,

We found an out of bounds array accessing bug in drivers/md/dm-ioctl.c, and
reproduced it in the latest kernel (v5.11.10).

The root cause of this BUG is :

The field ""data_size"" in function ctl_ioctl is fully controlled by users
and this argument controls the size of kvmalloc in function copy_params.

When the data_size is in a range of [0x131,0x138], the allocated memory
which is pointed by the variable ""param"" used in ioctl
""DM_LIST_DEVICES_CMD"" is too small, causing an oob bug at line ""nl->dev =
0; /* Flags no data */"" (
https://github.com/torvalds/linux/blob/0d02ec6b3136c73c09e7859f0d0e4e2c4c07b49b/drivers/md/dm-ioctl.c#L538
)

Attachments are the poc, kernel config and Kernel report.

The patch:
https://github.com/torvalds/linux/commit/4edbe1d7bcffcd6269f3b5eb63f710393ff2ec7a
     * Grab our output buffer.
     */
     nl = orig_nl = get_result_buffer(param, param_size, &len);
-    if (len < needed) {
+    if (len < needed || len < sizeof(nl->dev)) {
         param->flags |= DM_BUFFER_FULL_FLAG;
         goto out;
     }

Regards,
Bodong Zhao of NISL lab, Tsinghua University


Current thread:
Linux Kernel: out of bounds array access in dm-ioctl.c - Nop (Mar 27)

Re: Linux Kernel: out of bounds array access in dm-ioctl.c John Haxby (Mar 29)





"
"https://lists.debian.org/debian-lts-announce/2021/06/msg00020.html","lists.debian.org","0","Title:
[SECURITY] [DLA 2689-1] linux security update

Post:
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2689-1                debian-lts@lists.debian.org
https://www.debian.org/lts/security/                        Ben Hutchings
June 22, 2021                                 https://wiki.debian.org/LTS
-------------------------------------------------------------------------

Package        : linux
Version        : 4.9.272-1
CVE ID         : CVE-2020-24586 CVE-2020-24587 CVE-2020-24588 CVE-2020-25670
                 CVE-2020-25671 CVE-2020-25672 CVE-2020-26139 CVE-2020-26147
                 CVE-2020-26558 CVE-2020-29374 CVE-2020-36322 CVE-2021-0129
                 CVE-2021-3428 CVE-2021-3483 CVE-2021-3564 CVE-2021-3573
                 CVE-2021-3587 CVE-2021-20292 CVE-2021-23133 CVE-2021-23134
                 CVE-2021-28660 CVE-2021-28688 CVE-2021-28950 CVE-2021-28964
                 CVE-2021-28971 CVE-2021-29154 CVE-2021-29265 CVE-2021-29647
                 CVE-2021-29650 CVE-2021-30002 CVE-2021-31916 CVE-2021-32399
                 CVE-2021-33034

Several vulnerabilities have been discovered in the Linux kernel that
may lead to the execution of arbitrary code, privilege escalation,
denial of service, or information leaks.

This update is not yet available for the armel (ARM EABI soft-float)
architecture.

CVE-2020-24586, CVE-2020-24587, CVE-2020-26147

    Mathy Vanhoef discovered that many Wi-Fi implementations,
    including Linux's mac80211, did not correctly implement reassembly
    of fragmented packets.  In some circumstances, an attacker within
    range of a network could exploit these flaws to forge arbitrary
    packets and/or to access sensitive data on that network.

CVE-2020-24588

    Mathy Vanhoef discovered that most Wi-Fi implementations,
    including Linux's mac80211, did not authenticate the ""is
    aggregated"" packet header flag.  An attacker within range of a
    network could exploit this to forge arbitrary packets on that
    network.

CVE-2020-25670, CVE-2020-25671, CVE-2021-23134

    kiyin (尹亮) of TenCent discovered several reference counting bugs
    in the NFC LLCP implementation which could lead to use-after-free.
    A local user could exploit these for denial of service (crash or
    memory corruption) or possibly for privilege escalation.

    Nadav Markus and Or Cohen of Palo Alto Networks discovered that
    the original fixes for these introduced a new bug that could
    result in use-after-free and double-free.  This has also been
    fixed.

CVE-2020-25672

    kiyin (尹亮) of TenCent discovered a memory leak in the NFC LLCP
    implementation.  A local user could exploit this for denial of
    service (memory exhaustion).

CVE-2020-26139

    Mathy Vanhoef discovered that a bug in some Wi-Fi implementations,
    including Linux's mac80211.  When operating in AP mode, they would
    forward EAPOL frames from one client to another while the sender
    was not yet authenticated.  An attacker within range of a network
    could use this for denial of service or as an aid to exploiting
    other vulnerabilities.

CVE-2020-26558, CVE-2021-0129

    Researchers at ANSSI discovered vulnerabilities in the Bluetooth
    Passkey authentication method, and in Linux's implementation of
    it.  An attacker within range of two Bluetooth devices while they
    pair using Passkey authentication could exploit this to obtain the
    shared secret (Passkey) and then impersonate either of the devices
    to each other.

CVE-2020-29374

    Jann Horn of Google reported a flaw in Linux's virtual memory
    management.  A parent and child process initially share all their
    memory, but when either writes to a shared page, the page is
    duplicated and unshared (copy-on-write).  However, in case an
    operation such as vmsplice() required the kernel to take an
    additional reference to a shared page, and a copy-on-write occurs
    during this operation, the kernel might have accessed the wrong
    process's memory.  For some programs, this could lead to an
    information leak or data corruption.

CVE-2020-36322, CVE-2021-28950

    The syzbot tool found that the FUSE (filesystem-in-user-space)
    implementation did not correctly handle a FUSE server returning
    invalid attributes for a file.  A local user permitted to run a
    FUSE server could use this to cause a denial of service (crash).

    The original fix for this introduced a different potential denial
    of service (infinite loop in kernel space), which has also been
    fixed.

CVE-2021-3428

    Wolfgang Frisch reported a potential integer overflow in the ext4
    filesystem driver. A user permitted to mount arbitrary filesystem
    images could use this to cause a denial of service (crash).

CVE-2021-3483

    马哲宇 (Zheyu Ma) reported a bug in the ""nosy"" driver for TI
    PCILynx FireWire controllers, which could lead to list corruption
    and a use-after-free.  On a system that uses this driver, local
    users granted access to /dev/nosy could exploit this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2021-3564, CVE-2021-3573, CVE-2021-32399

    The BlockSec team discovered several race conditions in the
    Bluetooth subsystem that could lead to a use-after-free or
    double-free.  A local user could exploit these to caue a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2021-3587

    Active Defense Lab of Venustech discovered a potential null
    pointer dereference in the NFC LLCP implementation.  A local user
    could use this to cause a denial of service (crash).

CVE-2021-20292

    It was discovered that the TTM buffer allocation API used by GPU
    drivers did not handle allocation failures in the way that most
    drivers expected, resulting in a double-free on failure.  A local
    user on a system using one of these drivers could possibly exploit
    this to cause a denial of service (crash or memory corruption) or
    for privilege escalation.  The API has been changed to match
    driver expectations.

CVE-2021-23133

    Or Cohen of Palo Alto Networks discovered a race condition in the
    SCTP implementation, which can lead to list corruption.  A local
    user could exploit this to cause a denial of service (crash or
    memory corruption) or possibly for privilege escalation.

CVE-2021-28660

    It was discovered that the rtl8188eu WiFi driver did not correctly
    limit the length of SSIDs copied into scan results. An attacker
    within WiFi range could use this to cause a denial of service
    (crash or memory corruption) or possibly to execute code on a
    vulnerable system.

CVE-2021-28688 (XSA-371)

    It was discovered that the original fix for CVE-2021-26930
    (XSA-365) introduced a potential resource leak.  A malicious guest
    could presumably exploit this to cause a denial of service
    (resource exhaustion) within the host.

CVE-2021-28964

    Zygo Blaxell reported a race condition in the Btrfs driver which
    can lead to an assertion failure.  On systems using Btrfs, a local
    user could exploit this to cause a denial of service (crash).

CVE-2021-28971

    Vince Weaver reported a bug in the performance event handler for
    Intel PEBS.  A workaround for a hardware bug on Intel CPUs
    codenamed ""Haswell"" and earlier could lead to a null pointer
    dereference.  On systems with the affected CPUs, if users are
    permitted to access performance events, a local user may exploit
    this to cause a denial of service (crash).

    By default, unprivileged users do not have access to performance
    events, which mitigates this issue.  This is controlled by the
    kernel.perf_event_paranoid sysctl.

CVE-2021-29154

    It was discovered that the Extended BPF (eBPF) JIT compiler
    for x86_64 generated incorrect branch instructions in some
    cases.  On systems where eBPF JIT is enabled, users could
    exploit this to execute arbitrary code in the kernel.

    By default, eBPF JIT is disabled, mitigating this issue.  This is
    controlled by the net.core.bpf_jit_enable sysctl.

CVE-2021-29265

    The syzbot tool found a race condition in the USB/IP host
    (server) implementation which can lead to a null pointer
    dereference.  On a system acting as a USB/IP host, a client
    can exploit this to cause a denial of service (crash).

CVE-2021-29647

    The syzbot tool found an information leak in the Qualcomm IPC
    Router (qrtr) implementation.

    This protocol is not enabled in Debian's official kernel
    configurations.

CVE-2021-29650

    It was discovered that a data race in the netfilter subsystem
    could lead to a null pointer dereference during replacement of a
    table.  A local user with CAP_NET_ADMIN capability in any user
    namespace could use this to cause a denial of service (crash).

    By default, unprivileged users cannot create user namespaces,
    which mitigates this issue.  This is controlled by the
    kernel.unprivileged_userns_clone sysctl.

CVE-2021-30002

    Arnd Bergmann and the syzbot tool found a memory leak in the
    Video4Linux (v4l) subsystem.  A local user permitted to access
    video devices (by default, any member of the ""video"" group) could
    exploit this to cause a denial of service (memory exhaustion).

CVE-2021-31916

    Dan Carpenter reported incorrect parameter validation in the
    device-mapper (dm) subsystem, which could lead to a heap buffer
    overrun.  However, only users with CAP_SYS_ADMIN capability
    (i.e. root-equivalent) could trigger this bug, so it did not
    have any security impact in this kernel version.

CVE-2021-33034

    The syzbot tool found a bug in the Bluetooth subsystem that could
    lead to a use-after-free.  A local user could use this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

For Debian 9 stretch, these problems have been fixed in version
4.9.272-1.  This update additionally includes many more bug fixes from
stable updates 4.9.259-4.9.272 inclusive.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
https://security-tracker.debian.org/tracker/linux

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: https://wiki.debian.org/LTS

-- 
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams
"
"https://lists.debian.org/debian-lts-announce/2021/06/msg00019.html","lists.debian.org","0","Title:
[SECURITY] [DLA 2690-1] linux-4.19 security update

Post:
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2690-1                debian-lts@lists.debian.org
https://www.debian.org/lts/security/                        Ben Hutchings
June 22, 2021                                 https://wiki.debian.org/LTS
-------------------------------------------------------------------------

Package        : linux-4.19
Version        : 4.19.194-1~deb9u1
CVE ID         : CVE-2020-24586 CVE-2020-24587 CVE-2020-24588 CVE-2020-25670
                 CVE-2020-25671 CVE-2020-25672 CVE-2020-26139 CVE-2020-26147
                 CVE-2020-26558 CVE-2020-29374 CVE-2021-0129 CVE-2021-3483
                 CVE-2021-3506 CVE-2021-3564 CVE-2021-3573 CVE-2021-3587
                 CVE-2021-23133 CVE-2021-23134 CVE-2021-28688 CVE-2021-28964
                 CVE-2021-28971 CVE-2021-29154 CVE-2021-29155 CVE-2021-29264
                 CVE-2021-29647 CVE-2021-29650 CVE-2021-31829 CVE-2021-31916
                 CVE-2021-32399 CVE-2021-33034
Debian Bug     : 986949 988352 989451

Several vulnerabilities have been discovered in the Linux kernel that
may lead to the execution of arbitrary code, privilege escalation,
denial of service, or information leaks.

CVE-2020-24586, CVE-2020-24587, CVE-2020-26147

    Mathy Vanhoef discovered that many Wi-Fi implementations,
    including Linux's mac80211, did not correctly implement reassembly
    of fragmented packets.  In some circumstances, an attacker within
    range of a network could exploit these flaws to forge arbitrary
    packets and/or to access sensitive data on that network.

CVE-2020-24588

    Mathy Vanhoef discovered that most Wi-Fi implementations,
    including Linux's mac80211, did not authenticate the ""is
    aggregated"" packet header flag.  An attacker within range of a
    network could exploit this to forge arbitrary packets on that
    network.

CVE-2020-25670, CVE-2020-25671, CVE-2021-23134

    kiyin (尹亮) of TenCent discovered several reference counting bugs
    in the NFC LLCP implementation which could lead to use-after-free.
    A local user could exploit these for denial of service (crash or
    memory corruption) or possibly for privilege escalation.

    Nadav Markus and Or Cohen of Palo Alto Networks discovered that
    the original fixes for these introduced a new bug that could
    result in use-after-free and double-free.  This has also been
    fixed.

CVE-2020-25672

    kiyin (尹亮) of TenCent discovered a memory leak in the NFC LLCP
    implementation.  A local user could exploit this for denial of
    service (memory exhaustion).

CVE-2020-26139

    Mathy Vanhoef discovered that a bug in some Wi-Fi implementations,
    including Linux's mac80211.  When operating in AP mode, they would
    forward EAPOL frames from one client to another while the sender
    was not yet authenticated.  An attacker within range of a network
    could use this for denial of service or as an aid to exploiting
    other vulnerabilities.

CVE-2020-26558, CVE-2021-0129

    Researchers at ANSSI discovered vulnerabilities in the Bluetooth
    Passkey authentication method, and in Linux's implementation of
    it.  An attacker within range of two Bluetooth devices while they
    pair using Passkey authentication could exploit this to obtain the
    shared secret (Passkey) and then impersonate either of the devices
    to each other.

CVE-2020-29374

    Jann Horn of Google reported a flaw in Linux's virtual memory
    management.  A parent and child process initially share all their
    memory, but when either writes to a shared page, the page is
    duplicated and unshared (copy-on-write).  However, in case an
    operation such as vmsplice() required the kernel to take an
    additional reference to a shared page, and a copy-on-write occurs
    during this operation, the kernel might have accessed the wrong
    process's memory.  For some programs, this could lead to an
    information leak or data corruption.

CVE-2021-3483

    马哲宇 (Zheyu Ma) reported a bug in the ""nosy"" driver for TI
    PCILynx FireWire controllers, which could lead to list corruption
    and a use-after-free.  On a system that uses this driver, local
    users granted access to /dev/nosy could exploit this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2021-3506

    The ADLab of venustech discovered a bug in the F2FS driver which
    could lead to an out-of-bounds read when accessing a crafted
    filesystem.  A local user permitted to mount arbitrary filesystems
    could exploit this to cause a denial of service (crash) or other
    security impact.

CVE-2021-3564, CVE-2021-3573, CVE-2021-32399

    The BlockSec team discovered several race conditions in the
    Bluetooth subsystem that could lead to a use-after-free or
    double-free.  A local user could exploit these to caue a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2021-3587

    Active Defense Lab of Venustech discovered a potential null
    pointer dereference in the NFC LLCP implementation.  A local user
    could use this to cause a denial of service (crash).

CVE-2021-23133

    Or Cohen of Palo Alto Networks discovered a race condition in the
    SCTP implementation, which can lead to list corruption.  A local
    user could exploit this to cause a denial of service (crash or
    memory corruption) or possibly for privilege escalation.

CVE-2021-28688 (XSA-371)

    It was discovered that the original fix for CVE-2021-26930
    (XSA-365) introduced a potential resource leak.  A malicious guest
    could presumably exploit this to cause a denial of service
    (resource exhaustion) within the host.

CVE-2021-28964

    Zygo Blaxell reported a race condition in the Btrfs driver which
    can lead to an assertion failure.  On systems using Btrfs, a local
    user could exploit this to cause a denial of service (crash).

CVE-2021-28971

    Vince Weaver reported a bug in the performance event handler for
    Intel PEBS.  A workaround for a hardware bug on Intel CPUs
    codenamed ""Haswell"" and earlier could lead to a null pointer
    dereference.  On systems with the affected CPUs, if users are
    permitted to access performance events, a local user may exploit
    this to cause a denial of service (crash).

    By default, unprivileged users do not have access to performance
    events, which mitigates this issue.  This is controlled by the
    kernel.perf_event_paranoid sysctl.

CVE-2021-29154

    It was discovered that the Extended BPF (eBPF) JIT compiler
    for x86_64 generated incorrect branch instructions in some
    cases.  On systems where eBPF JIT is enabled, users could
    exploit this to execute arbitrary code in the kernel.

    By default, eBPF JIT is disabled, mitigating this issue.  This is
    controlled by the net.core.bpf_jit_enable sysctl.

CVE-2021-29155, CVE-2021-31829

    Piotr Krysiuk and Benedict Schlueter discovered that the Extended
    BPF (eBPF) verifier did not completely protect against information
    leaks due to speculative execution.  A local user could exploit
    these to obtain sensitive information from kernel memory.

CVE-2021-29264

    It was discovered that the ""gianfar"" Ethernet driver used with
    some Freescale SoCs did not correctly handle a Rx queue overrun
    when jumbo packets were enabled.  On systems using this driver and
    jumbo packets, an attacker on the network could exploit this to
    cause a denial of service (crash).

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-29647

    The syzbot tool found an information leak in the Qualcomm IPC
    Router (qrtr) implementation.

    This protocol is not enabled in Debian's official kernel
    configurations.

CVE-2021-29650

    It was discovered that a data race in the netfilter subsystem
    could lead to a null pointer dereference during replacement of a
    table.  A local user with CAP_NET_ADMIN capability in any user
    namespace could use this to cause a denial of service (crash).

    By default, unprivileged users cannot create user namespaces,
    which mitigates this issue.  This is controlled by the
    kernel.unprivileged_userns_clone sysctl.

CVE-2021-31916

    Dan Carpenter reported incorrect parameter validation in the
    device-mapper (dm) subsystem, which could lead to a heap buffer
    overrun.  However, only users with CAP_SYS_ADMIN capability
    (i.e. root-equivalent) could trigger this bug, so it did not
    have any security impact in this kernel version.

CVE-2021-33034

    The syzbot tool found a bug in the Bluetooth subsystem that could
    lead to a use-after-free.  A local user could use this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

For Debian 9 stretch, these problems have been fixed in version
4.19.194-1~deb9u1.  This update additionally fixes Debian bug
#986949, #988352, and #989451; and includes many more bug fixes from
stable updates 4.19.182-4.19.194 inclusive.

We recommend that you upgrade your linux-4.19 packages.

For the detailed security status of linux-4.19 please refer to
its security tracker page at:
https://security-tracker.debian.org/tracker/linux-4.19

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: https://wiki.debian.org/LTS

-- 
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams
"
